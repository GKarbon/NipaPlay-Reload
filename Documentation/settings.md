# 高级设置

## 播放器内核选择

NipaPlay 提供多种播放器内核，各有特点：

### 内核对比

- **Libmpv（推荐）**：
  - ✅ 支持硬件解码，性能优异
  - ✅ 兼容性强，支持各种视频格式和字幕
  - ✅ 解码能力完整（需 Windows 用户手动优化，见下文）
  - 🎯 **最推荐使用**，特别是性能受限的设备

- **MDK**：
  - ✅ 跨平台支持良好
  - ❌ 暂时不支持硬件解码
  - ⚠️ 性能受限设备不推荐使用

- **Video Player**：
  - ✅ Flutter 官方播放器，稳定性好
  - ⚠️ 功能相对基础，兼容性一般
  - 🔧 作为备选方案使用

### 切换建议

- **首选**：Libmpv（性能和兼容性最佳）
- **问题排查**：如遇播放问题，可尝试切换到其他内核进行对比
- **性能考虑**：低配置设备务必使用 Libmpv 以获得硬件解码支持

## Windows 平台解码器优化

> **重要**：Windows 版本由于上游 media-kit 的限制，默认的 libmpv 库解码器不够完整，可能无法播放某些格式或字幕（如 HDR、10bit、PGS字幕等）。

### 解决方案：手动替换 libmpv 库

社区提供了完整版本的 libmpv 库来解决解码器缺失问题：

#### 📋 兼容性要求

- **V3 版本**：需要 CPU 支持 AVX2 指令集（Intel 4代酷睿及以上，约2013年后）
- **普通版本**：需要 CPU 支持 AVX 指令集（Intel 2代酷睿及以上，约2011年后）
- **不支持 AVX**：无法使用此优化方案

#### 🔧 替换步骤

1. **检查 CPU 兼容性**：
   - 使用 CPU-Z 等工具确认 CPU 指令集支持
   - Intel 4代（Haswell）及以上推荐使用 V3 版本
   - Intel 2-3代可尝试普通版本

2. **下载完整版 libmpv**：
   - 访问 [MPV Windows 构建页面](https://sourceforge.net/projects/mpv-player-windows/files/libmpv/)
   - 下载适合的版本（推荐 V3 版本获得最佳兼容性）

3. **替换库文件**：
   - 关闭 NipaPlay
   - 找到安装目录（通常在 `Program Files` 或 `AppData` 下）
   - 备份原始的 `libmpv-2.dll` 文件
   - 将下载的 `libmpv-2.dll` 替换到安装目录
   - 重新启动 NipaPlay

#### ⚠️ 注意事项

- **CPU 不兼容**：使用不匹配的版本可能导致程序崩溃或无法启动
- **备份原文件**：替换前务必备份原始库文件，以便回滚
- **自承风险**：此为社区解决方案

#### 🎯 预期改善

替换后可解决以下问题：

- H.264/H.265 高级格式播放失败
- HDR10、10bit 视频黑屏
- 部分 AVC 编码无法解码
- 杜比视界等高级格式不支持

## 弹幕引擎配置

NipaPlay 支持GPU与CPU渲染的弹幕引擎：
- GPU渲染更高效，不过现阶段还有部分不完善的地方
- CPU渲染更稳定，性能开销较大

## 其他设置选项

### 日志与调试

**开发者选项** 中的日志功能对问题反馈非常重要：

**日志查看方式**：

1. 进入 设置 → 开发者选项 → 终端输出
2. 查看实时日志信息
3. 支持复制日志内容用于问题反馈

**移动端特色功能**：

- **Android/平板**：支持将日志导出为二维码，便于快速分享
- **跨设备传输**：通过二维码可快速将日志信息传输到其他设备

**问题反馈建议**：

- 在 GitHub Issues 中提交问题时
- 附带相关的日志信息
- 包含平台信息和详细的重现步骤
- 有助于开发者快速定位和解决问题

详细的日志获取步骤可参考 [故障排查](troubleshooting.md) 部分。

### 解码与性能优化

- **硬件/软件解码**：根据设备性能选择合适的解码方式
- **缓冲策略**：调整视频缓冲参数以适应网络环境
- **性能模式**：在性能和画质间找到平衡点

### 外观个性化

- **主题选择**：nipaplay/fluentui主题切换
- **壁纸设置**：自定义应用背景
- **透明度调整**：界面透明效果控制
- **毛玻璃效果**：现代化界面视觉效果强度调节

---

**⬅️ 上一篇: [媒体服务器整合](server-integration.md)** | **➡️ 下一篇: [常见问题](faq.md)**
